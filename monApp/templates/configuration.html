{% extends "base.html" %}

{% block title %}Page de configuration{% endblock %}

{# Ce bloc place le CSS dans le <head> du base.html #}
{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/config.css') }}">
{% endblock %}


{# Ce bloc remplit le <main> du base.html #}
{% block main %}

<form action="{{ url_for('configuration') }}" method="POST">
    <div class="container mt-5 pt-2">
        
        {% if error %}
            <div class="alert alert-danger" role="alert">
                {{ error }}
            </div>
        {% endif %}

        <section class="config-section">
            <section class="config-base">
                <h2>Configuration de base</h2>
                <div class="div-base">
                    <h4>Nombre de groupe</h4>
                    <div>
                        <input type="number" class="level-input" name="nb-grp" min="1" required>
                    </div>
                </div>
                <section class="section-importance">
                    <h4>Répartion d'importance </h4>
                    <div class="genre">
                        <h4>Genre</h4>
                        <input type="range" min="0" max="100" step="1" class="slider" value="25">
                        <div>
                            <input type="number" name="importance_genre" class="slider-value" min="0" max="100" step="1" value="25">
                        </div>
                    </div>

                    <div class="francais">
                        <h4>Niveau Français</h4>
                        <input type="range" min="0" max="100" step="1" class="slider" value="25">
                        <div>
                            <input type="number" name="importance_francais" class="slider-value" min="0" max="100" step="1" value="25">
                        </div>
                    </div>

                    <div class="maths">
                        <h4>Niveau Mathématiques</h4>
                        <input type="range" min="0" max="100" step="1" class="slider" value="25">
                        <div>
                            <input type="number" name="importance_maths" class="slider-value" min="0" max="100" step="1" value="25">
                        </div>
                    </div>

                    <div class="penibilite">
                        <h4>Pénibilité</h4>
                        <input type="range" min="0" max="100" step="1" class="slider" value="25">
                        <div>
                            <input type="number" name="importance_penibilite" class="slider-value" min="0" max="100" step="1" value="25">
                        </div>
                    </div>
                </section>
                
                <script>
                    const sliders = document.querySelectorAll(".slider");
                    const values = document.querySelectorAll(".slider-value");
                    const totalDisplay = document.getElementById("total");
                    const TOTAL_MAX = 100;

                    function updateTotal() {
                    let total = 0;
                    sliders.forEach(s => total += Number(s.value));
                    totalDisplay.textContent = total;
                    }

                    function adjustSliders(changedIndex) {
                    let total = 0;
                    sliders.forEach(s => total += Number(s.value));
                    if (total === TOTAL_MAX) return;

                    const diff = TOTAL_MAX - total;
                    const others = [...sliders].filter((_, i) => i !== changedIndex);
                    const adjust = diff / others.length;

                    others.forEach(s => {
                        let newVal = Number(s.value) + adjust;
                        if (newVal < 0) newVal = 0;
                        if (newVal > 100) newVal = 100;
                        s.value = newVal.toFixed(0);
                    });

                    sliders.forEach((s, i) => values[i].value = s.value);
                    updateTotal();
                    }

                    sliders.forEach((slider, i) => {
                    slider.addEventListener("input", () => {
                        values[i].value = slider.value;
                        adjustSliders(i);
                    });
                    });

                    values.forEach((v, i) => {
                    v.addEventListener("input", () => {
                        sliders[i].value = v.value;
                        adjustSliders(i);
                    });
                    });

                    updateTotal();
                </script>
            </section>
            <section class="config-groupe">
                </section>
        </section>

        <div class="submit-container" style="text-align: center; margin: 20px 0;">
            <button type="submit" class="btn btn-primary btn-lg">Lancer la répartition</button>
        </div>

    </div>
</form> {% endblock main %}